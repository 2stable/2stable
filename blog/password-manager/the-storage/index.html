<!DOCTYPE html><html lang="en" data-bs-theme="auto"><head><meta charset="UTF-8"><link type="application/atom+xml" rel="alternate" href="https://2stable.com/feed.xml" title="2Stable"><!-- Begin Jekyll SEO tag v2.8.0 --><title>How does Password Manager by 2Stable work under the hood? Part 2, The Storage. | 2Stable</title><meta name="generator" content="Jekyll v4.3.3"><meta property="og:title" content="How does Password Manager by 2Stable work under the hood? Part 2, The Storage."><meta name="author" content="c128128"><meta property="og:locale" content="en_US"><meta name="description" content="In our previous article, I talked all about the Vault in Password Manager by 2Stable. If you missed it, take a moment to check it out here. Now, let’s move on to the next big piece of the puzzle: creating what we call the Storage."><meta property="og:description" content="In our previous article, I talked all about the Vault in Password Manager by 2Stable. If you missed it, take a moment to check it out here. Now, let’s move on to the next big piece of the puzzle: creating what we call the Storage."><link rel="canonical" href="https://2stable.com/blog/password-manager/the-storage/"><meta property="og:url" content="https://2stable.com/blog/password-manager/the-storage/"><meta property="og:site_name" content="2Stable"><meta property="og:image" content="https://2stable.com/assets/img/blog/password-manager/the-storage.jpg"><meta property="og:image:alt" content="How does Password Manager by 2Stable work under the hood? Part 2, The Storage."><meta property="og:type" content="article"><meta property="article:published_time" content="2024-03-15T17:05:00+01:00"><meta name="twitter:card" content="summary_large_image"><meta property="twitter:image" content="https://2stable.com/assets/img/blog/password-manager/the-storage.jpg"><meta name="twitter:image:alt" content="How does Password Manager by 2Stable work under the hood? Part 2, The Storage."><meta property="twitter:title" content="How does Password Manager by 2Stable work under the hood? Part 2, The Storage."><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"c128128"},"dateModified":"2024-05-28T18:39:41+02:00","datePublished":"2024-03-15T17:05:00+01:00","description":"In our previous article, I talked all about the Vault in Password Manager by 2Stable. If you missed it, take a moment to check it out here. Now, let’s move on to the next big piece of the puzzle: creating what we call the Storage.","headline":"How does Password Manager by 2Stable work under the hood? Part 2, The Storage.","image":{"alt":"How does Password Manager by 2Stable work under the hood? Part 2, The Storage.","url":"https://2stable.com/assets/img/blog/password-manager/the-storage.jpg","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://2stable.com/blog/password-manager/the-storage/"},"url":"https://2stable.com/blog/password-manager/the-storage/"}</script><!-- End Jekyll SEO tag --><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="theme-color" content="#fff"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicon/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicon/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicon/favicon-16x16.png"><link rel="manifest" href="/site.webmanifest"><link rel="mask-icon" href="/assets/img/favicon/safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><!-- bootstrap-css-only --><link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous"><!-- bootstrap-icons  --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css"><!-- shared-css --><link rel="stylesheet" href="/shared/assets/css/shared.css"><!-- local-css --><!-- <link rel="stylesheet" href="/local.css"> --><!-- splitbee --><script async src="https://cdn.splitbee.io/sb.js"></script><!-- ahref --><meta name="apple-itunes-app" content="app-id=122171064"><!-- color-theme --><!-- <script src="/shared/assets/js/color-modes.js"></script> --><link rel="stylesheet" href="/css/github-markdown-light.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css"><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script><style>.markdown-body {
    box-sizing: border-box;
    min-width: 200px;
    max-width: 980px;
    margin: 0 auto;
    padding: 45px;
  }

  @media (max-width: 767px) {
    .markdown-body {
      padding: 15px;
    }
  }</style></head><body><div class="container py-2"><header class="d-flex flex-column flex-md-row align-items-center pt-3 justify-content-between"><div class="d-flex flex-column flex-md-row align-items-center"><div class="pe-0 pe-md-2"><a class="navbar-brand me-md-auto my-0 mx-0" href="/"><img src="/assets/img/auth-Icon-512.png" width="36" height="36" class="d-inline-block align-top rounded" alt="2Stable logo"></a></div><div class="me-md-auto mx-0"><div class="pb-md-0 pb-2 pt-1 pt-md-0 mb-0 small lh-sm w-100 text-center text-md-start"><a href="/"><strong class="fw-semibold fs-5 text-dark">2Stable</strong></a> <a href="https://2stable.com/" target="_blank" rel="noopener"><span class="d-block small text-dark">by <img src="/shared/assets/img/2Stable-Logo.svg" height="16" alt="2Stable Logo"></span></a></div></div></div><nav class="nav my-2 my-md-0 gap-2"><a class="p-2 nav-hover text-body-secondary" href="/team/" rel="noopener">Team</a> <a class="p-2 nav-hover text-body-secondary" href="/contact/" rel="noopener">Contact</a></nav></header></div><main id="content" class="container markdown-body py-0"><div class="row justify-content-center pb-4"><div><img class="w-100 rounded" src="/assets/img/blog/password-manager/the-storage.jpg" alt="How does Password Manager by 2Stable work under the hood? Part 2, The Storage." title="How does Password Manager by 2Stable work under the hood? Part 2, The Storage."></div><nav aria-label="breadcrumb"><ul class="breadcrumb mt-4 p-0"><li class="breadcrumb-item"><a href="/blog/">All</a></li><li class="breadcrumb-item m-0"><a href="/blog/password-manager/">Password Manager</a></li><li class="breadcrumb-item active m-0" aria-current="page">How does Password Manager by 2Stable work under the hood? Part 2, The Storage.</li></ul></nav><h1 class="text-body-emphasis">How does Password Manager by 2Stable work under the hood? Part 2, The Storage.</h1><div class="d-flex flex-column flex-md-row justify-content-between"><div class="d-flex align-items-center"><img class="rounded-circle my-2 me-2" width="44" src="https://pbs.twimg.com/profile_images/1678750625482285056/kW9fX0Pw_400x400.jpg" alt="Alex Vera author picture"><div class="w-100"><p class="mb-0"><span class="small text-body-secondary">by </span><a href="https://twitter.com/c128128" target="_blank" rel="noopener">Alex Vera</a></p><span class="d-block small">Founder & CEO</span></div></div><p class="d-flex align-items-center mb-0 gap-2 pt-3 small"><span class="text-body-secondary">28 May 2024</span> <span>·</span> <span class="text-body-secondary">7 minutes to read</span></p></div></div><div class="justify-content-center text-body-emphasis"><p>In our previous article, I talked all about the <strong>Vault</strong> in Password Manager by 2Stable. If you missed it, take a moment to check it out <object><a href="https://2stable.com/blog/all/password-manager/the-vault/">here</a></object>.</p><p>Now, let’s move on to the next big piece of the puzzle: creating what we call the <strong>Storage</strong>.<!--more--> Think of it as the core place where all your information is stored. It’s not just a regular <strong>database</strong>; it also acts as a <strong>synchronization engine</strong>, built to prioritize offline access. This approach means <strong>Storage</strong> has two main tasks: ensuring your data remains secure and keeping it synchronized across your devices, or with anyone you choose to share it with. And it does all this securely, ensuring that your information is both safe and accessible, whenever you need it, without compromising on privacy or security.</p><p>Let’s start with <strong>Storage</strong>’s first responsibility: persisting data. For our app, we picked a database that many developers like, called <a href="https://github.com/realm/realm-swift"><strong>Realm</strong></a> by MongoDB. Why <strong>Realm</strong>, you might ask? It’s because <strong>Realm</strong> is designed for speed and efficiency, making it perfect for mobile applications like ours. Plus, it has robust <strong>encryption</strong> capabilities that work seamlessly with our security model. This means your data is not just stored; it’s stored securely, ensuring that without the <code class="language-plaintext highlighter-rouge">Master Key</code>, your information remains unreadable and safe.</p><blockquote><p>From the MongoDB website, we learn that <strong>Realm</strong> keeps your data safe using an encryption algorithm called AES-256 + SHA-2. Think of AES-256 as a super-strong lock that only the right key can open. And SHA-2 helps make sure nobody has tampered with your data. This combination makes your information very secure. If you want to know more about how it works, check it out <a href="https://www.mongodb.com/docs/realm/sdk/swift/realm-files/encrypt-a-realm/#overview">here</a>.</p></blockquote><p>Now, let’s talk about the second important job of <strong>Storage</strong>: making sure your data is in sync. In today’s world, it’s super important to have your information available on all your devices or to share it safely with others. <strong>Storage</strong> isn’t just for keeping your data safe; it also makes sure that all your info is updated and in sync, even if you’re not online. When you do get back online, <strong>Storage</strong> automatically updates your info across all your devices or with anyone you’ve decided to share it with. Plus, if you use <strong>iCloud</strong> to store your data, we keep it <strong>encrypted</strong> there too, making sure it’s always protected. This syncing is all about keeping your data safe and under your control, everywhere you go.</p><blockquote><p>You might have noticed the mention of <strong>iCloud</strong> earlier and wondered how it fits into our security model. <strong>iCloud</strong> uses a technology called <strong>CloudKit</strong>, which is Apple’s powerful cloud storage framework. <strong>CloudKit</strong> gives you a secure and private space online that only you can access. This is key for us at <strong>2Stable</strong> because it means your data is stored in a place where we can’t directly access it. We make sure not to store your personal data on our servers; instead, your encrypted information is safely kept within Apple’s <strong>CloudKit</strong>. This method enhances security and ensures that you’re the only one in control of your data.</p></blockquote><p>At this moment, we have all the information needed to dive deeper into how we integrate <strong>Realm</strong> and your <strong>iCloud</strong> storage together using <strong>Storage</strong>.</p><p>First, we create four instances of <strong>Storage</strong>:</p><ul><li><code class="language-plaintext highlighter-rouge">.privateZones</code> (keeps track of your private zones)</li><li><code class="language-plaintext highlighter-rouge">.sharedZones</code> (keeps track of your shared zones)</li><li><code class="language-plaintext highlighter-rouge">.vaults</code> (stores your encrypted <strong>Vault</strong>s)</li><li><code class="language-plaintext highlighter-rouge">.versioning</code> (keeps track of app version, in case you try to sync an old app with a new one)</li></ul><p>None of them are encrypted.</p><p>These <strong>Storage</strong>s don’t store any sensitive information; we primarily use them for organizational purposes.</p><p>Next, we create the <code class="language-plaintext highlighter-rouge">VaultStorage</code>. This <strong>Storage</strong> instance is created with the primary key of the created <code class="language-plaintext highlighter-rouge">Vault</code> and encrypted with your <code class="language-plaintext highlighter-rouge">Master Key</code>. This key is exactly the size we need, 512 bits (64 bytes).</p><p>In <code class="language-plaintext highlighter-rouge">VaultStorage</code>, we keep and sync:</p><ul><li>Group Encryption Keys</li><li>Profile</li><li>Favorites Primaries</li><li>Autofill Primaries</li><li>Used Primaries</li><li>Shared Settings</li></ul><blockquote><p>In general, we keep in <code class="language-plaintext highlighter-rouge">VaultStorage</code> all data that needs to be synced with your other devices but not with your shared groups.</p></blockquote><p>Regarding the data stored in <code class="language-plaintext highlighter-rouge">VaultStorage</code>, we have properties such as <code class="language-plaintext highlighter-rouge">Favorite</code>, <code class="language-plaintext highlighter-rouge">Autofill</code>, <code class="language-plaintext highlighter-rouge">Used</code>, and <code class="language-plaintext highlighter-rouge">Shared Settings</code>. These properties are designed to be shared across the user’s devices but not with their groups. For example, if you mark an item as a favorite, it should not be automatically marked as a favorite for other members of the group.</p><p>In our app, users can organize their data into <strong>Groups</strong>. Each group matches a CloudKit Zone. This design has many benefits. CloudKit custom zones can be shared, and we use this feature. But, to keep all safe, we encrypt every object we add to these zones. For this encryption, we use <strong>Group Encryption Keys</strong>, next referred to as <code class="language-plaintext highlighter-rouge">GEKs</code>.</p><p>In our app, you have three kinds of groups for your items: <code class="language-plaintext highlighter-rouge">Personal</code>, <code class="language-plaintext highlighter-rouge">Private</code>, and <code class="language-plaintext highlighter-rouge">Shared</code>. The <code class="language-plaintext highlighter-rouge">Personal</code> group is just for you and can’t be shared, keeping your personal stuff safe from being accidentally shared. The <code class="language-plaintext highlighter-rouge">Private</code> group can be shared if you want. Everything in this group is kept in the iCloud of the person who made the group, called the admin. The <code class="language-plaintext highlighter-rouge">Shared</code> group is a group someone else shared with you. The stuff in this group is actually in the iCloud of the person who shared it, who is also the admin.</p><blockquote><p>In our current design, <code class="language-plaintext highlighter-rouge">Shared</code> and <code class="language-plaintext highlighter-rouge">Private</code> groups look the same, but they are actually different, as described before. In fact, if you create a new group and haven’t shared it with anyone yet, then this group is considered <code class="language-plaintext highlighter-rouge">Private</code>.</p></blockquote><p>When you create a new <strong>Group</strong>, we generate a <code class="language-plaintext highlighter-rouge">GEK</code> for it. This key is similar to the one we use for the <strong>Vault</strong>, having the same size of 512 bits (64 bytes), but it comes with extra details like <code class="language-plaintext highlighter-rouge">isSharable</code> and more.</p><p>Now we create a new instance of <strong>Storage</strong> with the <strong>Group</strong> primary key and the <code class="language-plaintext highlighter-rouge">GEK</code>, and this data is persisted in our <code class="language-plaintext highlighter-rouge">VaultStorage</code>. This way, you can access the objects in this group when you unlock the app next time.</p><p>For <code class="language-plaintext highlighter-rouge">Shared</code> groups, it works a bit differently. We don’t make a new <code class="language-plaintext highlighter-rouge">GEK</code>; instead, someone shares the key with you. I’ll go into details on how we securely share the <code class="language-plaintext highlighter-rouge">GEK</code> in my next article. But for now, it’s essential to know that this data is safely stored in <code class="language-plaintext highlighter-rouge">VaultStorage</code> too.</p><p>To summarize:</p><ol><li>We maintain four unencrypted <strong>Storage</strong> instances for organizational purposes.</li><li>The <code class="language-plaintext highlighter-rouge">VaultStorage</code> is encrypted with the <code class="language-plaintext highlighter-rouge">Master Key</code> and syncs exclusively with your devices.</li><li><code class="language-plaintext highlighter-rouge">Personal</code> and <code class="language-plaintext highlighter-rouge">Private</code> groups, which you create, have their <code class="language-plaintext highlighter-rouge">GEKs</code> generated by you. These <code class="language-plaintext highlighter-rouge">GEKs</code> are securely stored in <code class="language-plaintext highlighter-rouge">VaultStorage</code>.</li><li><code class="language-plaintext highlighter-rouge">Shared Groups</code> are established when someone invites you to join their group. The <code class="language-plaintext highlighter-rouge">GEK</code> for these groups is securely shared with you and is also stored in <code class="language-plaintext highlighter-rouge">VaultStorage</code>.</li></ol><p>In my next article, I’ll explain how we securely share the <code class="language-plaintext highlighter-rouge">GEK</code> of <code class="language-plaintext highlighter-rouge">Shared</code> <strong>Group</strong>s with you. Additionally, I’ll address the purpose of having <code class="language-plaintext highlighter-rouge">Profile</code> in our <code class="language-plaintext highlighter-rouge">VaultStorage</code>. This way, you’ll have a better understanding of how we keep your data safe and secure. Stay tuned for more insights into our robust security measures, ensuring your peace of mind when using <strong>Password Manager by 2Stable</strong>!</p><div class="mt-4 mb-2"><p class="text-muted mb-1">Share this article:</p><div style="height: 30px;" class=""><a href="https://twitter.com/share?ref_src=twsrc%5Etfw" class="twitter-share-button" data-size="large" rel="author" data-via="c128128 " data-hashtags="">Tweet</a><script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script></div></div><ul class="list-unstyled ps-0"><li><p class="text-muted mb-1">Published: <span class="small fw-bold text-body-emphasis">15 Mar 2024</span></p></li><li><p class="text-muted mb-1">Updated: <span class="small fw-bold text-body-emphasis">28 May 2024</span></p></li></ul></div></main><div class="py-1 px-2" onclick="topFunction()" id="myBtn" title="Go to top"><i class="h2 bi bi-arrow-up-short"></i></div><footer class="footer bg-footer px-2 pt-5 pt-md-5 text-white mt-5"><div class="container pt-3 pt-md-0"><div class="row pb-3"><div class="col-md-4 me-auto pb-3 pb-md-0 mb-4"><!-- <a class="d-inline-flex align-items-center mb-2 link-dark text-decoration-none" href="/" aria-label="2Stable">
            <span class="fs-5 text-white">2Stable</span>
          </a> --><div class="mb-2"><a class="navbar-brand me-md-auto my-0 mx-0" href="/"><img src="/assets/img/2Stable-Logo.svg" height="30" class="d-inline-block align-top" alt="2Stable logo"></a></div><p class="fs-6 pb-2 pb-sm-3 opacity-60">Transforming touches into digital magic.</p><ul class="list-inline d-flex flex-md-column flex-row"><li class="me-3"><a class="d-inline-flex align-items-center widget-link" href="https://twitter.com/authwidget" target="_blank" rel="noopener"><img src="/shared/assets/img/socials/twitter.com.png" class="rounded-1" width="22" height="22" alt="Authenticator App Twitter Page"> <span class="ms-2">Twitter</span></a></li><li class="me-3"><a class="d-inline-flex align-items-center widget-link" href="https://www.youtube.com/@2StableApps" target="_blank" rel="noopener"><img src="/shared/assets/img/socials/youtube.com.svg" class="rounded-1" width="22" height="22" alt="Authenticator App YouTube Page"> <span class="ms-2">YouTube</span></a></li></ul></div><div class="col-6 col-md-3 col-xl-2 mb-4"><div class="widget widget-light"><h5 class="widget-title">Company</h5><ul class="list-inline"><li><a class="widget-link" href="/team/" rel="noopener">Team</a></li><li><a class="widget-link" href="/contact/" rel="noopener">Contact</a></li></ul></div></div><div class="col-6 col-md-3 col-xl-2 mb-4"><div class="widget widget-light"><h5 class="widget-title">Resources</h5><ul class="list-inline"><li><a class="widget-link" href="/blog/" rel="noopener">Blog</a></li></ul></div></div><div class="col-md-4 col-lg-2 cmb-4"><div class="widget widget-light"><h5 class="widget-title">Products</h5><ul class="list-inline"><li><a class="widget-link" href="https://authenticator.2stable.com" rel="noopener">Authenticator App</a></li><li class="widget-link m-0"><a class="widget-link" href="https://passwords.2stable.com" rel="noopener">Password Manager <span class="badge bg-success">NEW</span></a></li><li><a class="widget-link" href="https://passkeys.2stable.com" rel="noopener">Passkeys App</a></li></ul></div></div></div><hr class="my-0 border-light"><div class="row align-items-center mt-3 pt-4 pb-3"><div class="col-md-4 order-3 order-md-3 text-md-end mb-2"><ul class="list-inline fs-sm mb-0"></ul></div><div class="col-md-4 order-1 order-md-2 text-md-center mb-2 mb-md-5"><img class="mb-2" src="/shared/assets/img/andorra-shield.svg" width="20" height="24" alt="andorra shield"><p class="m-0"><span class="text-light opacity-75">For the world, Made in Andorra.</span></p></div><div class="col-md-4 order-2 order-md-1 mb-2"><p class="m-0"><a class="nav-link-style nav-link-light text-white" href="https://2stable.com" rel="noopener">© 2Stable.</a><span class="text-light opacity-75 me-1"> All rights reserved.</span></p></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.7/dist/umd/popper.min.js" integrity="sha384-zYPOMqeu1DAVkHiLqWBUTcbYfZ8osu1Nd6Z89ify25QV9guujx43ITvfi12/QExE" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/anchor-js/anchor.min.js"></script><script>document.addEventListener('DOMContentLoaded', function() {
      anchors.options = {
        placement: 'right', // Place anchor links on the right
        visible: 'hover touch',  // Always show the anchor links
        // icon: '#'          // Use the '#' symbol for the anchor icon
      };
      anchors.add('h2, h3'); // Add anchors to h2 and h3 headings
    });</script><script>hljs.highlightAll();</script><script src="/shared/assets/js/backtotop.js"></script><script src="/shared/assets/js/thanks.js"></script><script src="/shared/assets/js/anchor.js"></script></body></html>