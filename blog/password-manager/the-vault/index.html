<!DOCTYPE html><html lang="en" data-bs-theme="auto"><head><meta charset="UTF-8"><link type="application/atom+xml" rel="alternate" href="https://2stable.com/feed.xml" title="2Stable"><!-- Begin Jekyll SEO tag v2.8.0 --><title>How does Password Manager by 2Stable work under the hood? Part 1, The Vault. | 2Stable</title><meta name="generator" content="Jekyll v4.3.3"><meta property="og:title" content="How does Password Manager by 2Stable work under the hood? Part 1, The Vault."><meta name="author" content="c128128"><meta property="og:locale" content="en_US"><meta name="description" content="Today, I will try to explain how Password Manager by 2Stable works, with some tech details to help you understand it better. I’ll show you how we use some cool tech to keep your passwords safe and make your online life easier."><meta property="og:description" content="Today, I will try to explain how Password Manager by 2Stable works, with some tech details to help you understand it better. I’ll show you how we use some cool tech to keep your passwords safe and make your online life easier."><link rel="canonical" href="https://2stable.com/blog/password-manager/the-vault/"><meta property="og:url" content="https://2stable.com/blog/password-manager/the-vault/"><meta property="og:site_name" content="2Stable"><meta property="og:image" content="https://2stable.com/assets/img/blog/password-manager/how-encryption-works.jpg"><meta property="og:image:alt" content="How does Password Manager by 2Stable work under the hood? Part 1, The Vault."><meta property="og:type" content="article"><meta property="article:published_time" content="2024-03-14T17:05:00+01:00"><meta name="twitter:card" content="summary_large_image"><meta property="twitter:image" content="https://2stable.com/assets/img/blog/password-manager/how-encryption-works.jpg"><meta name="twitter:image:alt" content="How does Password Manager by 2Stable work under the hood? Part 1, The Vault."><meta property="twitter:title" content="How does Password Manager by 2Stable work under the hood? Part 1, The Vault."><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"c128128"},"dateModified":"2024-06-26T17:34:28+02:00","datePublished":"2024-03-14T17:05:00+01:00","description":"Today, I will try to explain how Password Manager by 2Stable works, with some tech details to help you understand it better. I’ll show you how we use some cool tech to keep your passwords safe and make your online life easier.","headline":"How does Password Manager by 2Stable work under the hood? Part 1, The Vault.","image":{"alt":"How does Password Manager by 2Stable work under the hood? Part 1, The Vault.","url":"https://2stable.com/assets/img/blog/password-manager/how-encryption-works.jpg","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://2stable.com/blog/password-manager/the-vault/"},"url":"https://2stable.com/blog/password-manager/the-vault/"}</script><!-- End Jekyll SEO tag --><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="theme-color" content="#fff"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicon/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicon/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicon/favicon-16x16.png"><link rel="manifest" href="/site.webmanifest"><link rel="mask-icon" href="/assets/img/favicon/safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><!-- bootstrap-css-only --><link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous"><!-- bootstrap-icons  --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css"><!-- shared-css --><link rel="stylesheet" href="/shared/assets/css/shared.css"><!-- local-css --><!-- <link rel="stylesheet" href="/local.css"> --><!-- splitbee --><script async src="https://cdn.splitbee.io/sb.js"></script><!-- ahref --><meta name="apple-itunes-app" content="app-id=122171064"><!-- color-theme --><!-- <script src="/shared/assets/js/color-modes.js"></script> --><link rel="stylesheet" href="/css/github-markdown-light.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css"><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script><style>.markdown-body {
    box-sizing: border-box;
    min-width: 200px;
    max-width: 980px;
    margin: 0 auto;
    padding: 45px;
  }

  @media (max-width: 767px) {
    .markdown-body {
      padding: 15px;
    }
  }</style></head><body><div class="container py-2"><header class="d-flex flex-column flex-md-row align-items-center pt-3 justify-content-between"><div class="d-flex flex-column flex-md-row align-items-center"><div class="pe-0 pe-md-2"><a class="navbar-brand me-md-auto my-0 mx-0" href="/"><img src="/assets/img/auth-Icon-512.png" width="36" height="36" class="d-inline-block align-top rounded" alt="2Stable logo"></a></div><div class="me-md-auto mx-0"><div class="pb-md-0 pb-2 pt-1 pt-md-0 mb-0 small lh-sm w-100 text-center text-md-start"><a href="/"><strong class="fw-semibold fs-5 text-dark">2Stable</strong></a> <a href="https://2stable.com/" target="_blank" rel="noopener"><span class="d-block small text-dark">by <img src="/shared/assets/img/2Stable-Logo.svg" height="16" alt="2Stable Logo"></span></a></div></div></div><nav class="nav my-2 my-md-0 gap-2"><a class="p-2 nav-hover text-body-secondary" href="/team/" rel="noopener">Team</a> <a class="p-2 nav-hover text-body-secondary" href="/contact/" rel="noopener">Contact</a></nav></header></div><main id="content" class="container markdown-body py-0"><div class="row justify-content-center pb-4"><div><img class="w-100 rounded" src="/assets/img/blog/password-manager/how-encryption-works.jpg" alt="How does Password Manager by 2Stable work under the hood? Part 1, The Vault." title="How does Password Manager by 2Stable work under the hood? Part 1, The Vault."></div><nav aria-label="breadcrumb"><ul class="breadcrumb mt-4 p-0"><li class="breadcrumb-item"><a href="/blog/">All</a></li><li class="breadcrumb-item m-0"><a href="/blog/password-manager/">Password Manager</a></li><li class="breadcrumb-item active m-0" aria-current="page">How does Password Manager by 2Stable work under the hood? Part 1, The Vault.</li></ul></nav><h1 class="text-body-emphasis">How does Password Manager by 2Stable work under the hood? Part 1, The Vault.</h1><div class="d-flex flex-column flex-md-row justify-content-between"><div class="d-flex align-items-center"><img class="rounded-circle my-2 me-2" width="44" src="https://pbs.twimg.com/profile_images/1678750625482285056/kW9fX0Pw_400x400.jpg" alt="Alex Vera author picture"><div class="w-100"><p class="mb-0"><span class="small text-body-secondary">by </span><a href="https://twitter.com/c128128" target="_blank" rel="noopener">Alex Vera</a></p><span class="d-block small">Founder & CEO</span></div></div><p class="d-flex align-items-center mb-0 gap-2 pt-3 small"><span class="text-body-secondary">26 Jun 2024</span> <span>·</span> <span class="text-body-secondary">5 minutes to read</span></p></div></div><div class="justify-content-center text-body-emphasis"><p>Today, I will try to explain how Password Manager by 2Stable works, with some tech details to help you understand it better. I’ll show you how we use some cool tech to keep your passwords safe and make your online life easier.<!--more--> Expect a deep dive into the technical aspects, complete with links to documentation and source codes. You’ll get a clear picture of how we make sure your passwords are really secure.</p><p>So, let’s dive in and see how Password Manager by 2Stable works to keep your online stuff safe.</p><h2 id="the-vault">The Vault</h2><p>To begin, let’s understand a simple but important idea in digital security:</p><blockquote><p>Encryption is Easy, Key Management is Hard.</p></blockquote><p>This idea is key to how we do things. Here’s a simple look at how we address this in our app.</p><p>When you sign up, your first step is to create what we call a <strong>Vault</strong> as you begin using the app. But this <strong>Vault</strong> isn’t just a place to store items; it’s a unique space from which your own encryption key is generated. This encryption key is crucial for securing your information, ensuring that only you can access it. It’s like having a secret formula that guarantees everything in your <strong>Vault</strong> remains secure and accessible only to you.</p><p>The first step in creating a <strong>Vault</strong> is to choose a <strong>Password</strong>. This password, often referred to as the <strong>Master Password</strong>.</p><p>This <strong>Password</strong> isn’t saved or stored anywhere except in your head. It’s important to remember it, as there are no ways to recover it if forgotten.</p><p>After confirming the password, we generate an encryption key, known as the <code class="language-plaintext highlighter-rouge">Master Key</code> or <code class="language-plaintext highlighter-rouge">MK</code>. The <code class="language-plaintext highlighter-rouge">Master Key</code> is a random key consisting of 512 bits (64 bytes).</p><p>Additionally, we create another key, called the <code class="language-plaintext highlighter-rouge">Intermediate Key</code> or <code class="language-plaintext highlighter-rouge">IK</code>. The <code class="language-plaintext highlighter-rouge">Intermediate Key</code> is a random key comprising 256 bits (32 bytes).</p><p>Next, we generate a <code class="language-plaintext highlighter-rouge">Salt</code>. The <code class="language-plaintext highlighter-rouge">Salt</code> is a 128-bit (16 bytes) random data.</p><p>Following this, we perform some manipulations with your <strong>Password</strong>:</p><ul><li>We trim any whitespaces and newlines.</li><li>We normalize the <strong>Password</strong> using the <a href="https://developer.apple.com/documentation/foundation/nsstring/1415417-decomposedstringwithcompatibilit">Unicode Normalization Form KD</a>.</li></ul><p>This normalized <strong>Password</strong> is now referred to as <code class="language-plaintext highlighter-rouge">NP</code>.</p><p>At this point, we’re ready to derive the so-called <code class="language-plaintext highlighter-rouge">Derivated Master Password</code> or <code class="language-plaintext highlighter-rouge">DMP</code>. We achieve this by utilizing the <code class="language-plaintext highlighter-rouge">Argon2ID13</code> algorithm along with the <code class="language-plaintext highlighter-rouge">NP</code> and the <code class="language-plaintext highlighter-rouge">Salt</code>, using a <code class="language-plaintext highlighter-rouge">minimum memory size</code> of <strong>32 MB</strong>, a <code class="language-plaintext highlighter-rouge">minimum number of iterations</code> of <strong>20</strong>, and a <code class="language-plaintext highlighter-rouge">degree of parallelism</code> of <strong>1</strong>. More information about this process can be found <a href="https://cheatsheetseries.owasp.org/cheatsheets/Password_Storage_Cheat_Sheet.html#argon2id">here</a>.</p><p>Next, we encrypt the <code class="language-plaintext highlighter-rouge">IK</code> with our <code class="language-plaintext highlighter-rouge">DMP</code> using <code class="language-plaintext highlighter-rouge">xchacha20poly1305ietf</code> and a <code class="language-plaintext highlighter-rouge">Nonce</code> of 192 bits (24 bytes). This encrypted <code class="language-plaintext highlighter-rouge">IK</code> is denoted as <code class="language-plaintext highlighter-rouge">EIK</code>. More information about this encryption process can be found <a href="https://libsodium.gitbook.io/doc/advanced/stream_ciphers/xchacha20">here</a>.</p><p>The next step is to encrypt our <code class="language-plaintext highlighter-rouge">MK</code> with our <code class="language-plaintext highlighter-rouge">IK</code> using the same <code class="language-plaintext highlighter-rouge">xchacha20poly1305ietf</code> algorithm. The resulting encrypted <code class="language-plaintext highlighter-rouge">MK</code> is denoted as <code class="language-plaintext highlighter-rouge">EMK</code>.</p><p>Let’s sum up:</p><ol><li>Generate <code class="language-plaintext highlighter-rouge">Master Key</code> = <code class="language-plaintext highlighter-rouge">MK</code></li><li>Generate <code class="language-plaintext highlighter-rouge">Intermediate Key</code> = <code class="language-plaintext highlighter-rouge">IK</code></li><li>Generate <code class="language-plaintext highlighter-rouge">Salt</code> = <code class="language-plaintext highlighter-rouge">Salt</code></li><li><code class="language-plaintext highlighter-rouge">trim(Password)</code> = <code class="language-plaintext highlighter-rouge">Password</code></li><li><code class="language-plaintext highlighter-rouge">normalize(Password)</code> = <code class="language-plaintext highlighter-rouge">NP</code></li><li><code class="language-plaintext highlighter-rouge">Argon2ID13(NP, Salt, 20, 32*1024*1024, 1)</code> = <code class="language-plaintext highlighter-rouge">DMP</code></li><li><code class="language-plaintext highlighter-rouge">xchacha20poly1305ietf(IK, DMP)</code> = <code class="language-plaintext highlighter-rouge">EIK</code></li><li><code class="language-plaintext highlighter-rouge">xchacha20poly1305ietf(MK, IK)</code> = <code class="language-plaintext highlighter-rouge">EMK</code></li></ol><p>Finally, we are ready to create our <strong>Vault</strong> struct, which looks like this in Swift:</p><div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">Vault</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">primary</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">version</span><span class="p">:</span> <span class="kt">UInt64</span>
    <span class="k">let</span> <span class="nv">salt</span><span class="p">:</span> <span class="kt">Crypto</span><span class="o">.</span><span class="kt">Kdf</span><span class="o">.</span><span class="kt">Salt</span>
    <span class="k">let</span> <span class="nv">encryptedIntermediateKey</span><span class="p">:</span> <span class="kt">Bytes</span>
    <span class="k">let</span> <span class="nv">encryptedMasterKey</span><span class="p">:</span> <span class="kt">Bytes</span>
<span class="p">}</span>
</code></pre></div></div><blockquote><p>We include the version property in case we need to migrate the <strong>Vault</strong> to some other algorithm or parameters.</p></blockquote><p>So, we’ve created the <strong>Vault</strong>, and it can be stored on your device. More importantly, this <strong>Vault</strong> is designed to be synced with the user’s <strong>iCloud</strong>. This means you can get back your <code class="language-plaintext highlighter-rouge">Master Key</code> from any of your devices that are connected to the same iCloud account. Just remember your <strong>Password</strong>.</p><blockquote><p><strong>Keep in mind</strong> that at this point, your <code class="language-plaintext highlighter-rouge">Master Key</code> is secure as long as you choose a <strong>Strong Password</strong>. We want to emphasize the importance of understanding the risks involved. While we don’t enforce any limitations on <strong>Password</strong> choice, it is crucial that you pick a <strong>strong, unique password</strong> to ensure the security of your Vault and its contents.</p></blockquote><p>Why do we need the <code class="language-plaintext highlighter-rouge">Intermediate Key</code>?</p><p>When you use your fingerprint or face to unlock your app, it doesn’t make sense to use <code class="language-plaintext highlighter-rouge">Argon2ID13</code>, which can be really resource-intensive. For example, in cases like the Autofill Extension, where there’s a limit of only <code class="language-plaintext highlighter-rouge">120 MB</code> of memory available, using <code class="language-plaintext highlighter-rouge">Argon2ID13</code> would be too much. So instead, we store the <code class="language-plaintext highlighter-rouge">Intermediate Key</code> in a secure place called the Secure Enclave.</p><blockquote><p>Secure Enclave is a special part of the device’s hardware that’s specifically designed to keep sensitive information safe.</p></blockquote><p>In the future, we’re thinking about adding a special feature called an <code class="language-plaintext highlighter-rouge">Emergency Kit</code>. It’s like a secret code that you can scan to get into your account if you forget your <strong>Password</strong>. But you don’t really want to include your <strong>Password</strong> in this <code class="language-plaintext highlighter-rouge">Emergency Kit</code>, in case you want to keep it, like under a rock or in your parents’ safe. Instead, you want to include the <code class="language-plaintext highlighter-rouge">Intermediate Key</code>.</p><p>We’ve just gone through the process of how the <strong>Vault</strong> is created in our Password Manager. This is a key part in safeguarding your digital life, ensuring that your sensitive information is well-protected.</p><p>Next, I’ll dive into how we use the <code class="language-plaintext highlighter-rouge">Master Key</code> in our security setup.</p><p>Stay with us as we continue to reveal more about our security measures, designed to keep your information secure while making it easily accessible to you.</p><div class="mt-4 mb-2"><p class="text-muted mb-1">Share this article:</p><div style="height: 30px;" class=""><a href="https://twitter.com/share?ref_src=twsrc%5Etfw" class="twitter-share-button" data-size="large" rel="author" data-via="c128128 " data-hashtags="">Tweet</a><script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script></div></div><ul class="list-unstyled ps-0"><li><p class="text-muted mb-1">Published: <span class="small fw-bold text-body-emphasis">14 Mar 2024</span></p></li><li><p class="text-muted mb-1">Updated: <span class="small fw-bold text-body-emphasis">26 Jun 2024</span></p></li></ul></div></main><div class="py-1 px-2" onclick="topFunction()" id="myBtn" title="Go to top"><i class="h2 bi bi-arrow-up-short"></i></div><footer class="footer bg-footer px-2 pt-5 pt-md-5 text-white mt-5"><div class="container pt-3 pt-md-0"><div class="row pb-3"><div class="col-md-4 me-auto pb-3 pb-md-0 mb-4"><!-- <a class="d-inline-flex align-items-center mb-2 link-dark text-decoration-none" href="/" aria-label="2Stable">
            <span class="fs-5 text-white">2Stable</span>
          </a> --><div class="mb-2"><a class="navbar-brand me-md-auto my-0 mx-0" href="/"><img src="/assets/img/2Stable-Logo.svg" height="30" class="d-inline-block align-top" alt="2Stable logo"></a></div><p class="fs-6 pb-2 pb-sm-3 opacity-60">Transforming touches into digital magic.</p><ul class="list-inline d-flex flex-md-column flex-row"><li class="me-3"><a class="d-inline-flex align-items-center widget-link" href="https://twitter.com/authwidget" target="_blank" rel="noopener"><img src="/shared/assets/img/socials/twitter.com.png" class="rounded-1" width="22" height="22" alt="Authenticator App Twitter Page"> <span class="ms-2">Twitter</span></a></li><li class="me-3"><a class="d-inline-flex align-items-center widget-link" href="https://www.youtube.com/@2StableApps" target="_blank" rel="noopener"><img src="/shared/assets/img/socials/youtube.com.svg" class="rounded-1" width="22" height="22" alt="Authenticator App YouTube Page"> <span class="ms-2">YouTube</span></a></li></ul></div><div class="col-6 col-md-3 col-xl-2 mb-4"><div class="widget widget-light"><h5 class="widget-title">Company</h5><ul class="list-inline"><li><a class="widget-link" href="/team/" rel="noopener">Team</a></li><li><a class="widget-link" href="/contact/" rel="noopener">Contact</a></li></ul></div></div><div class="col-6 col-md-3 col-xl-2 mb-4"><div class="widget widget-light"><h5 class="widget-title">Resources</h5><ul class="list-inline"><li><a class="widget-link" href="/blog/" rel="noopener">Blog</a></li></ul></div></div><div class="col-md-4 col-lg-2 cmb-4"><div class="widget widget-light"><h5 class="widget-title">Products</h5><ul class="list-inline"><li><a class="widget-link" href="https://authenticator.2stable.com" rel="noopener">Authenticator App</a></li><li class="widget-link m-0"><a class="widget-link" href="https://passwords.2stable.com" rel="noopener">Password Manager <span class="badge bg-success">NEW</span></a></li><li><a class="widget-link" href="https://passkeys.2stable.com" rel="noopener">Passkeys App</a></li></ul></div></div></div><hr class="my-0 border-light"><div class="row align-items-center mt-3 pt-4 pb-3"><div class="col-md-4 order-3 order-md-3 text-md-end mb-2"><ul class="list-inline fs-sm mb-0"></ul></div><div class="col-md-4 order-1 order-md-2 text-md-center mb-2 mb-md-5"><img class="mb-2" src="/shared/assets/img/andorra-shield.svg" width="20" height="24" alt="andorra shield"><p class="m-0"><span class="text-light opacity-75">For the world, Made in Andorra.</span></p></div><div class="col-md-4 order-2 order-md-1 mb-2"><p class="m-0"><a class="nav-link-style nav-link-light text-white" href="https://2stable.com" rel="noopener">© 2Stable.</a><span class="text-light opacity-75 me-1"> All rights reserved.</span></p></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.7/dist/umd/popper.min.js" integrity="sha384-zYPOMqeu1DAVkHiLqWBUTcbYfZ8osu1Nd6Z89ify25QV9guujx43ITvfi12/QExE" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/anchor-js/anchor.min.js"></script><script>document.addEventListener('DOMContentLoaded', function() {
      anchors.options = {
        placement: 'right', // Place anchor links on the right
        visible: 'hover touch',  // Always show the anchor links
        // icon: '#'          // Use the '#' symbol for the anchor icon
      };
      anchors.add('h2, h3'); // Add anchors to h2 and h3 headings
    });</script><script>hljs.highlightAll();</script><script src="/shared/assets/js/backtotop.js"></script><script src="/shared/assets/js/thanks.js"></script><script src="/shared/assets/js/anchor.js"></script></body></html>